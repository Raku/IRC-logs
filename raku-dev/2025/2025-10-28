[01:00] *** librasteve_ left
[01:56] *** guifa left
[07:27] *** melezhik joined
[07:57] <ab5tract> what's the base-compiler version of $context.ensure-sc ?

[07:59] <ab5tract> is there a method on $*W or something?

[08:30] <lizmat> add_object_if_no_sc ?

[08:31] <lizmat> ab5tract ^^

[08:38] <ab5tract> lizmat: thanks!

[08:38] <ab5tract> this nominalizable thing is so weird

[08:39] <ab5tract> why would the nominalization of a subset be the nominalization of its refinee?

[08:39] <ab5tract> (for example)

[08:40] <ab5tract> the code is basically $!of := self.IMPL-MAYBE-NOMINALIZE: $of

[08:40] <ab5tract> in the  container creator

[08:41] <ab5tract> that's why in v6e .VAR.default isn't giving the subset, because its "nominalization" is just the refinee (or its nominalization)

[08:42] <ab5tract> it seems far fetched that in one language version you get the subset type object and in the next you get its refinee

[09:08] <lizmat> agree

[09:30] *** librasteve_ joined
[10:25] <Geth> ¬¶ rakudo/main: 44bb652dce | (Elizabeth Mattijsen)++ | src/Raku/ast/code.rakumod

[10:25] <Geth> ¬¶ rakudo/main: RakuAST: allow ::Block.new() to take :$multiness

[10:25] <Geth> ¬¶ rakudo/main: 

[10:25] <Geth> ¬¶ rakudo/main: This is apparently being passed to it in some situations, but does

[10:25] <Geth> ¬¶ rakudo/main: not apparently serve any purpose in the ::Block case.

[10:25] <Geth> ¬¶ rakudo/main: 

[10:25] <Geth> ¬¶ rakudo/main: This may be a band-aid type of fix, but since there is apparently

[10:25] <Geth> ¬¶ rakudo/main: already the same situation for :$signature, it feels it is ok to

[10:25] <Geth> ¬¶ rakudo/main: apply a similar fix for this case.

[10:25] <Geth> ¬¶ rakudo/main: 

[10:26] <Geth> ¬¶ rakudo/main: Fixes #5997

[10:26] <Geth> ¬¶ rakudo/main: review: https://github.com/rakudo/rakudo/commit/44bb652dce

[10:35] <ab5tract> I think nine++ is right, just need to drop this, fix roast, and move on

[10:54] *** Pixi` joined
[10:58] *** Pixi left
[11:24] <melezhik> .

[11:25] <melezhik> I wonder if there an API or Raku module that calculate a REVERSE dependency count for specific Raku distribution ?

[11:26] <melezhik> I probably might do it myself , it just would be handy if something already exists 

[11:27] <melezhik> I know Raku.land shows such counters

[11:27] <melezhik> For modules

[11:28] <lizmat> https://raku.land/zef:lizmat/Ecosystem#reverse-dependencies perhaps?

[11:31] <melezhik> lizmat: great üëç

[11:31] <melezhik> ^^ ab5tract ))

[11:39] <lizmat> also, potentially https://raku.land/zef:lizmat/Ecosystem#river 

[11:49] <melezhik> Yep , exactly üëç that , you read my mind )

[11:49] <melezhik> https://github.com/melezhik/brownie/commit/facd1f37fb8b89d744e9f6f73a033f0e9334f7e4

[12:06] <[Coke]> I wanted that for App::zef-deps and never finished it, oops

[12:06] <[Coke]> releasable6: next

[12:06] <releasable6> [Coke], Next release in ‚âà18 days and ‚âà6 hours. There are no known blockers. 24 out of 24 commits logged

[14:30] *** librasteve_ left
[16:07] <ugexe> zef rdepends Foo lists reverse dependencies 

[16:12] <[Coke]> ugexe++

[16:17] <ab5tract> the ecosystem approach fits a bit better here, but I'm glad we've got redundancy

[16:18] <[Coke]> melezhik: if you can successfully test "Red" in your setup, that would be impressive.

[16:19] <[Coke]> Or both versions of JSON::Class for that matter.

[16:20] <melezhik> [Coke]: we are in the way to that )

[16:20] <[Coke]> in the way... "on the path"?

[16:20] <[Coke]> it's in the roadmap?

[16:39] <ab5tract> I think melezhik means that we are almost ready to do a full run of the ecosystem

[16:39] <ab5tract> right now we are testing what happens with a shared install directory with 8 agent containers

[16:40] <ab5tract> going pretty good so far

[16:40] <ab5tract> most recent stastic is 11 minutes to test the first 100 most depended on libs (no shared volume)

[16:41] <timo> how do we handle stuff like "we need to install DB libraries for testing much of DBIish"?

[16:42] <ab5tract> timo: you mean native deps?

[16:43] <ab5tract> I guess we just add them to the Dockerfile as we encounter them

[16:44] <ab5tract> did I understand you correctly tho?

[16:45] <timo> yeah, native deps

[16:46] <timo> some stuff can only really be tested with a bit more setup, like a running database server with the right access credentials and stuff, which is potentially quite a bit more effort still

[16:46] *** librasteve_ joined
[16:46] <ab5tract> I think it makes sense to pre-install native deps. I'm not sure how to automate that but even doing it by hand shouldn't be *too* terrible

[16:47] <ab5tract> timo: that's fair, but then we might also just do the usual exclusion of say, `pg`

[16:47] <ab5tract> Anything that requires full setup is going to be on the developer to test fully

[16:48] <ab5tract> or perhaps add some stuff to the agent/sparrow code that handles their particular cornercase, if they want to be "all in in blin", so to speak

[16:50] <timo> blin is for the benefit of the core development team to find stuff that breaks stuff in the ecosystem, so at least for some important modules i think adding that effort can be beneficial, and it's better for us to make such breakage show up in blin than for us to wait for module developers/maintainers to build a pre-release rakudo and run their own tests

[16:50] <timo> it's very much a question of degrees, though

[16:50] <ab5tract> yeah, fully agreed

[16:51] <ab5tract> luckily I think the frameworks that melezhik++ has put together should make even setting up and starting a postgres server straightforward

[16:51] <timo> i think some things are reasonable, like running a postgres server and a mysql server so we can run tests for our database driver modules

[16:52] <timo> "run a Xephyr server so that GUI toolkit tests can at least run" might be acceptable, too

[16:52] <timo> we don't have very many modules like that

[16:54] <ab5tract> ugexe: can multiple zefs install to the same directory or would each zef be contending on a single repo lock?

[16:54] <ab5tract> here I'm talking about a cluster of containers with a single shared volume

[16:56] <timo> i wonder. maybe the lock is only held for the "staging" part but downloading, precompiling, testing can happen without holding?

[16:59] *** ab5tract_ joined
[17:00] <[Coke]> (native deps) that's how blin handles them now. we preinstall what we need.

[17:01] <[Coke]> if we find a module is failing because of a non-preinstalled dep, we add it to the list and rerun.

[17:01] <melezhik> Brownie mimics that as well https://github.com/melezhik/brownie/blob/aa43ca7b129fcbaf817ba3322f4d93a34e0717c4/agent/Dockerfile#L33

[17:02] <melezhik> But if we need more sophisticated scenarios it‚Äôs quite easy to enable them via sparky

[17:02] <ab5tract_> okay, thought on the naming .. what about "brownie" -> "bling"

[17:02] <melezhik> Like spinning up Mariadb or whatever

[17:02] <ab5tract_> too cute, maybe?

[17:05] <melezhik> I am open for renaming )

[17:05] <melezhik> We can launch a vote on mastodon or something

[17:08] <melezhik> Or fosstodon

[17:09] *** ab5tract_ left
[17:15] *** ab5tract_ joined
[17:16] *** ab5tract_ left
[17:17] *** ab5tract_ joined
[17:18] <ab5tract_> I'm starting to like brownie in it's own right. it just occured to me, the blin -> bling. but maybe even better is blin -> blink (because it runs so much faster)

[17:19] <ab5tract_> as it's an internal-focused tool, I wouldn't be very concerned about discoverability

[17:50] *** ab5tract_ left
[18:45] <ab5tract> [Coke]: looks like we are through 500 modules tested after ~ 1 hour

[18:49] <ab5tract> I think that the shared volumw helps a lot. If there is indeed contention issues on the repository, we could spread the resources over fewer containers and raise the degree in the zef config

[19:10] <ugexe> any locks for installation are done by rakudo on a per-repo basis

[19:11] <melezhik> Yep . Indeed after 1,5 hour brownie have completed 775 modules

[19:12] <ugexe> if blin is using --install-to= to install to custom locations then it wouldnt be using staging and would be installing the old way

[19:13] *** librasteve_ left
[19:17] <ugexe> also i don't think precompiling can happen without holding the lock

[19:17] <ugexe> the results of precompilation could change from when it is started to when it finished if someone adds files while it is precompiling

[19:19] *** melezhik_ joined
[19:21] *** melezhik_ left
[19:21] <ugexe> if you could find a way to avoid setting --install-to / ZEF_INSTALL_TO and just installed to the default site repo it would be quite a bit faster

[19:24] <melezhik> How changing installation to default site repo would solve concurrency issue?

[19:25] <melezhik> I mean we can change the location , but having shared file storage with multiple zef installs on the time still remain

[19:25] <melezhik> This is what happens now

[19:31] <melezhik> For example - https://gist.github.com/melezhik/9e9a5390ddc5f9fdf87705c01f4dfaee

[19:33] <melezhik> Also this http://brw.sparrowhub.io/file_view/agent.report/xvgjyilmktqpezdfnhus.27523/Humming-Bird.log

[19:35] <melezhik> Not sure how to read this - zef fails to install Hamming Bird or it successfully installed but just threw few warnings about already installed dependencies ? Anyway exit code is not zero , thus why sparrow treats this as a failure‚Ä¶

[19:38] <[Coke]> There is a skiplist of bad modules you can swipe from blin as needed

[19:39] <[Coke]> https://github.com/Raku/Blin/blob/8497e679aafcd84e9e46696928423b169b53e3dc/bin/blin.p6#L51C1-L70C7

[19:39] <[Coke]> (of course, if they work you don't have to skip them)

[19:40] <ugexe> anytime you want me to comment on zef output i would suggesting running with --debug

[19:41] <ugexe> if i were to guess why it is failing it is related to rakudo precompilation

[19:42] <ugexe> er, actually i assume it is because you have ZEF_INSTALL_TO set to something without also having RAKULIB set

[19:44] <ugexe> without RAKULIB being set to (what i assume is) /root, and assuming TestML is already installed there, rakudo is not going to see that module or that it is installed

[19:46] <ab5tract> ugexe: fair, though for the purposes of validating installation that should be fine, no?

[19:48] <ugexe> it is inherently going to be flakey but maybe that is acceptable

[19:49] <ab5tract> so our plan so far is to sort the input by reverse dependencies and start with the most used ones

[19:51] <ab5tract> but actually when it comes to the lock, I guess the actual dists being installed are less important

[19:51] <melezhik> ugexe: so we also need to set RAKULIB so that zef will see installed modules, right ?

[19:52] <ugexe> if that is the problem then yeah. im just taking a wild guess

[19:52] <ab5tract> ah, yeah that makes sense

[19:53] <melezhik> Ok . I guess this explain that , easy to patch . So we need to add export RAKULIB=$ZEF_INSTALl_TO:$RAKULIB ?

[20:07] <melezhik> Ok . I just checked - RAKULIB="inst#/root/zef_install" should work

[20:07] <melezhik> ^^ ab5tract

[20:08] <ab5tract> nice

[20:12] *** disbot1 joined
[20:13] <disbot1> <whistlingzephyr> testing the Discord bridge

[20:14] <disbot1> <whistlingzephyr> alright, works

[21:37] *** librasteve_ joined
[22:42] *** melezhik left
