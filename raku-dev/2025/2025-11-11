[00:20] <[Coke]> Where do you see the runs?

[00:29] <[Coke]> I see that pipelines is available in Raku org, but zero evidence of any runs in raku/nqp

[00:34] <[Coke]> ah. randomly guessed dev.azure.com/raku

[00:40] <[Coke]> ok; I removed the pipeline app from the org. Now I have no idea how to re-add it. :|

[00:43] <[Coke]> ok, in azdo, add a new pipeline. But it wants to do it as me, with access to all the orgs I have access to (not just raku)

[00:45] <[Coke]> https://dev.azure.com/Raku/nqp/_build/results?buildId=3&view=results

[00:46] <[Coke]> new job queued

[00:46] <[Coke]> I setup *only* raku/nqp

[00:56] *** JimmyZhuo joined
[00:57] <JimmyZhuo> timo: thanks for review

[01:02] *** librasteve_ left
[01:08] <[Coke]> job mostly done, mac jvm failed, win/lin jvm still running, everything else green

[01:08] <[Coke]> patrickb: let me know if it's cool?

[01:10] *** JimmyZhuo left
[05:03] *** [Coke] left
[05:03] *** [Coke] joined
[07:00] <patrickb> Coke: I believe it is finally done! Thank you so much,

[08:25] <ab5tract> some time ago I was a bit harsh about NQP::Config in this channel

[08:25] <ab5tract> I would like to retract my statements and apologize

[08:25] <ab5tract> It's actually a good example of a software that Just Works and doesn't need much in the way of maintenance

[09:14] *** bisectable6 left
[09:15] *** evalable6 left
[09:16] *** evalable6 joined
[09:16] *** unicodable6 left
[09:16] *** unicodable6 joined
[10:05] *** melezhik_ joined
[10:05] <melezhik_> o/

[10:06] <melezhik_> I've added whateverabke support to brownie, now one can test against specific rakudo commit - http://brw.sparrowhub.io/project/brw-orch

[10:07] <melezhik_> rakudo_version input field should be 40 symbols git commit sha

[10:08] <melezhik_> login: admin password: admin

[10:08] <melezhik_> cc ab5tract: [Coke]:

[10:13] *** melezhik_ left
[10:13] *** melezhik_ joined
[10:18] *** melezhik_ left
[10:18] *** melezhik_ joined
[10:21] *** melezhik_ left
[11:44] <lizmat> m: dd True ?| (say "foo")     # /me wonders whether infix   ?&   ?|   ?^    should short-circuit

[11:44] <camelia> rakudo-moar f7ce946e1: OUTPUT: «foo␤Bool::True␤»

[11:47] *** melezhik_ joined
[11:47] <melezhik_> run zef install Kind against latest Rakudo commit 

[11:47] <melezhik_> http://brw.sparrowhub.io/report/brw-orch/120

[11:52] *** melezhik_ left
[12:27] *** melezhik_ joined
[12:28] <melezhik_> [Coke]: currently there is just a one agent in pool ( which runs from my laptop and so often is offline )

[12:31] <melezhik_> run it 7 threads though ), so will try to run another 100 random modules and get timing ...

[12:44] *** melezhik_ left
[12:44] *** melezhik_ joined
[12:48] *** melezhik_ left
[12:55] *** melezhik_ joined
[12:55] <lizmat> m: dd :[ 1,2,3 ]    # wonder whether this should be a compilation error, it's really invalid syntax at this moment

[12:56] <camelia> rakudo-moar f7ce946e1: OUTPUT: «[1, 2, 3]␤»

[13:00] *** melezhik_ left
[13:02] *** melezhik_ joined
[13:06] *** melezhik_ left
[13:11] *** melezhik_ joined
[13:21] *** melezhik_ left
[13:21] *** melezhik_ joined
[13:32] *** [Tux] left
[13:34] *** lizmat_ joined
[13:36] *** [Tux] joined
[13:37] *** lizmat left
[13:39] *** melezhik_ left
[15:00] <releasable6> Next release in ≈4 days and ≈3 hours. There are no known blockers. Please log your changes in the ChangeLog: https://github.com/rakudo/rakudo/wiki/ChangeLog-Draft

[15:16] <[Coke]> ⏳ 343 out of 2385 modules processed (14.38%)

[16:26] <[Coke]> ⏳ 533 out of 2385 modules processed (22.34%)

[16:30] *** coleman left
[16:32] *** coleman joined
[17:04] <[Coke]> crash

[17:04] <[Coke]> very annoying that blin not only crashes but *kills the shell that was running it*

[17:05] <[Coke]> had another tmux window open this time, and while it stayed open, the original window just closed out.

[17:06] <timo> [Coke]: if it's oom-related, you do have some control over how process trees get killed, via cgroups

[17:12] <[Coke]> I see "Running Ad-Hoc Processes in cgroups" on https://documentation.ubuntu.com/security/security-features/privilege-restriction/cgroups/ - this is showing me how to set limits but I'm not seeing control over how they get killed, just why

[17:13] <[Coke]> er, when

[17:13] <timo> right, systemd-run is a convenient tool to get a fresh cgroup for a command

[17:13] <timo> i think tmux might have cgroups set up for processes in its panes

[17:13] <timo> does something relevant show up in `systemd-cgls`?

[17:14] <timo> i see a cgroup called "tmux-spawn-[uuid].scope inside my app.slice

[17:15] <[Coke]> ... also it makes me enter a password when running that. I don't think I *have* the password for this account, just an ssh key

[17:16] <timo> that might depend on ... many things

[17:16] <[Coke]> "too magic for my blood"

[17:16] <timo> try `systemd-run --user ...` to communicate with your user's very own systemd instance, instead of the system-wide one

[17:18] <[Coke]> Running as unit: blin.service; invocation ID: c674dd29d729405bbbbd90eabf6bdba2

[17:18] <[Coke]> ... and it immediately returned, no output from the process...

[17:18] <timo> haha, right

[17:18] <timo> it's a bit like "docker run", if you don't ask for it to hook up to your tty and be interactive, it won't

[17:19] <timo> you'll see what it does in the journal, but you probably want it directly in your terminal?

[17:19] <[Coke]> "the journal"?

[17:19] <timo> the --property  /  -p flag lets you add properties just like the `systemctl set-property` command

[17:20] <timo> yeah `journalctl -f` to follow it

[17:20] <[Coke]> Nov 11 17:17:52 raku-blin raku[105144]: Could not open bin/blin.p6. Failed to stat file: no such file or directory

[17:21] <timo> ah, it also doesn't inherit your environment by default i assume?

[17:21] <[Coke]> I have no idea - you're the one teaching me right now. :)

[17:22] <timo> are you passing -d aka --same-dir? that could be the issue actually

[17:22] <[Coke]> Best case, it looks like this will let me kill blin, leaving the tmux window open - that still doesn't really help

[17:23] <[Coke]> RAKULIB=. systemd-run --user --unit=blin --slice=user.slice --property="CPUWeight=100" --property="MemoryMax=12G" raku -

[17:23] <[Coke]> -ll-exception bin/blin.p6 --old=$OLD --new=$NEW --nproc-multiplier=$NPROCMULT --heartbeat=$HEARTBEAT 2>&1 | tee blin.out

[17:24] <[Coke]> I will try throwing more hardware at this, but that'll be later.

[17:24] <[Coke]> (the tee there is useless, will remove that)

[17:25] <[Coke]> This seems like a lot of setup to try something that doesn't feel like it's going to add any value.

[17:26] <[Coke]> (and it takes over an hour for the blin run to fail, so I don't even get quick turnaround here.)

[17:26] <timo> to make sure the RAKULIB=. makes it in, put it as -E RAKULIB=. as an argument to systemd-run

[17:27] <[Coke]> Will just throw more hardware at it this week and hope that I don't have to do another release before brownie is done.

[17:27] <timo> and to get the output in your terminal and such, pass --tty --wait

[17:29] <[Coke]> Failed to start transient service unit: Unit blin.service was already loaded or has a fragment file.

[17:29] <timo> ah, haha, i guess that's what you get if you don't --collect :D

[17:30] <timo> i guess it has to be manually unloaded? never had to do that myself i don't think, because by default it gives the unit a random name

[17:31] <timo> maybe systemctl reset-failed blin.service does it?

[17:31] <[Coke]> "systemctl --user reset-failed" worked to clear it

[17:31] <timo> oh, right, --user will also always have to be passed to systemctl to interact with the@s

[17:33] <[Coke]> ok, added working-directory, it's now running

[17:33] <[Coke]> Now it'll take 5m for it to get to a point where I can see if I've over-limited the cpu

[17:33] <timo> you can find all the properties that the thing currently has, for inspiration what you may be interested in changing, with `systemctl --user show --all blin.service`

[17:35] <[Coke]> ... thats over 400 lines long

[17:35] <timo> yup!

[17:35] <[Coke]> after one screen, my brain went smooth

[17:35] <timo> it's only 200 for my tmux-spawn slice

[17:36] <timo> OOMPolicy= could be interesting

[17:37] <[Coke]> OOMPolicy=stop

[17:37] *** melezhik_ joined
[17:38] <[Coke]> askubuntu suggesting maybe "sudo apt remove systemd-oomd

[17:38] <timo> if i understand right, stop means that if anything inside the unit is oom-killed, systemd will stop the unit for you. another option is OOMPolicy=continue which lets the unit continue running

[17:39] <timo> removing oomd takes away some control over how OOM happens, the kernel will still oom-kill stuff for you happily

[17:39] <[Coke]> oh. Mem:           15942        6650        8666           8         979        9291

[17:39] <timo> though note that the control it gives includes making kills happen earlier

[17:39] <[Coke]> Swap:           4095         494        3601

[17:40] <timo> that looks like 9 gigs of ram available?

[17:40] <[Coke]> 16G total

[17:40] <[Coke]> (blin is currently running, so we're using about 6 as we start up)

[17:40] <[Coke]> but I'm wondering if I cheaped out on the swap

[17:41] <timo> do you have zram swap as well as a swap file or partition?

[17:41] <[Coke]> ?

[17:42] <timo> if you have `zramctl`, it'll output if there's any zram thingies, on my system it has one with "MOUNTPOINT" "[SWAP]"

[17:42] <[Coke]> zramctl -> says nothing

[17:43] <timo> i have 6.5 gigabytes worth of data in mine, but they only take up 3.3 gigs thanks to its compression

[17:44] <[Coke]> afk for a bit

[17:45] *** melezhik2 joined
[17:45] <timo> there's a lot of neat stuff you can do if you harness the features systemd offers

[17:45] <timo> i was thinking that rakudo could by default log to the journal when it's doing precomp work, for example

[17:46] <melezhik2> .

[17:46] <melezhik2> [Coke]: are you interested in testing out brownie ?

[17:47] *** melezhik2 left
[17:47] <melezhik_> .

[17:48] *** melezhik joined
[17:48] <timo> maybe not immediately before a release?

[17:49] <melezhik_> I mean we can do it in parallel and not necessarily on all modules

[17:51] <melezhik_> which commit are being tested right now on blin, btw?

[17:51] <timo> i assume it'd be main and the NQP_REVISION and MOAR_REVISION

[17:53] <melezhik_> ok

[17:56] <timo> that's why release managers tend to become a little bit annoyed when someone merges to rakudo main very shortly before a release while blin is blinning

[17:59] *** melezhik_ left
[18:24] *** melezhik_ joined
[18:30] *** melezhik_ left
[18:32] <Geth> ¦ rakudo/andthen-orelse: 10 commits pushed by ab5tract++

[18:32] <Geth> ¦ rakudo/andthen-orelse: review: https://github.com/rakudo/rakudo/compare/1499dafcd31e...e523bc1c2703

[18:32] <ab5tract> melezhik: I'm getting ready to try a run on the commit from e523bc1c2703c63d1639b5095f65afca85c38f20

[18:33] <ab5tract> sorry, from R#5917

[18:33] <linkable6> R#5917 [open]: https://github.com/rakudo/rakudo/pull/5917 New andthen/orelse for 6.e

[18:33] *** melezhik_ joined
[18:33] <melezhik_> .

[18:34] <ab5tract> melezhik_: o/

[18:34] *** lizmat_ left
[18:34] <melezhik_> ab5tract: hi!

[18:34] <ab5tract> I'd like to test e523bc1c2703c63d1639b5095f65afca85c38f20 -- exactly because I want to know how rude it would be to merge right before a release ;)

[18:34] *** lizmat joined
[18:34] <melezhik_> I thought something happened on the way to your trip ))

[18:35] <melezhik_> ok, running o10r on it

[18:35] <melezhik_> 100 modules

[18:35] <melezhik_> http://brw.sparrowhub.io/report/brw-orch/2

[18:36] <melezhik_> please make sure agent build from the latest commiy

[18:36] <melezhik_> commit

[18:36] <ab5tract> alright. locally I have 1 agent with 7 jobs / 7 cores / 12612 mb

[18:36] <melezhik_> cool

[18:36] <melezhik_> 100 modules is enough ?

[18:38] <melezhik_> run mine agent on my laptop with 8 threads as well

[18:40] <melezhik_> ok - download https://whateverable.6lang.org/e523bc1c27 ... FAILED

[18:41] <melezhik_> is it already on whateverable ?

[18:41] <melezhik_> ah, this PR commit , not published to main ...

[18:41] <melezhik_> sigh 

[18:41] <ab5tract> ah, I thought it tracked off-main commits

[18:42] <ab5tract> it might be due to my just pushing it very recently?

[18:42] <melezhik_> in that case it needs to compile them

[18:42] <ab5tract> worth trying again in a few minutes I think

[18:42] <melezhik_> I am not sure if PR's commits even are punished to whateverable?

[18:43] <melezhik_> published

[18:50] <[Coke]> Finished with result: oom-kill

[18:51] <[Coke]> c: e523bc1c27 3.put

[18:51] <committable6> [Coke], ¦e523bc1: «Cannot find this revision (did you mean “5733721”?)»

[18:51] <lizmat> [Coke]: as soon as you have an idea which module is OOMing, lemme know

[18:51] <[Coke]> ^^ that's how you can test here if a revision has a build

[18:53] <[Coke]> guessing it's one of these, lizmat : https://gist.github.com/coke/34eb7fc14ca77c2c29b38702a0073fb7

[18:54] <[Coke]> as I am only testing 8 simultaneously.

[18:54] <melezhik_> ab5tract: worth to add compilation for commit into brownie?

[18:59] <lizmat> Serialize-Naive fails for me because of lack of a META6.json file?

[19:00] <[Coke]> could be, that listing is just showing "about to test", not "tested"

[19:00] <lizmat> Slang:Date is also faulty (only a single :)

[19:00] <[Coke]> we have 1 commit in moarvm that needs to be pulled into nqp/rakudo

[19:01] <[Coke]> (3 altogether, but one that changes code)

[19:01] <lizmat> those are the ones that fail for me, but nowhere near an OOM

[19:01] <lizmat> (on HEAD)

[19:01] <[Coke]> bah

[19:01] <[Coke]> lizmat++ for checking

[19:02] <melezhik_> it could be memory leak on blin overall maybe ? just a thought ... 

[19:07] <melezhik_> c: e523bc1c27 3.put

[19:07] <committable6> melezhik_, ¦e523bc1: «Cannot find this revision (did you mean “5733721”?)»

[19:07] <lizmat> if it's a leak in blin, perhaps try with a different set of modules ?

[19:19] *** melezhik_ left
[19:19] *** melezhik_ joined
[19:21] <lizmat> [Coke]: one thing I just realized, with 64G RAM I guess it won't OOM for me any time soon

[19:25] *** melezhik_ left
[19:25] *** melezhik_ joined
[19:26] <[Coke]> melezhik_: it's only started occuring the last 2 releases.

[19:27] <[Coke]> I will probably build a new azure vm with more memory tonight. :|

[19:27] <[Coke]> (no need to jump through hoops if we're trying to switch away)

[19:30] *** melezhik_ left
[19:30] *** melezhik_ joined
[19:34] <[Coke]> for some reason I thought I had maxed out something here, but I can just pick a bigger box and press "resize"

[19:34] <[Coke]> going for 8 core, 64G

[19:34] <[Coke]> (was at 8/16)

[19:36] <[Coke]> .. wow, took about 2 seconds and a restart to get it back

[19:36] <[Coke]> yay cloud

[20:07] *** melezhik_ left
[20:38] *** melezhik left
[20:44] <lizmat> [Coke]: would you be ok with a RakuAST commit at this stage?

[20:45] <[Coke]> as long as it passes tests and you also bump the moarvm/nqp revs. :)

[20:45] <[Coke]> If this run works, I'll do another run tomorrow JIC.

[20:45] <[Coke]> going afk for a few hours, ta

[20:46] <lizmat> it wouldn't need a dump in MoarVM or NQP

[20:46] <lizmat> pure nqp in the ast dir

[20:47] <ab5tract> melezhik_: I think it would be worth it. Usually when I want to run a blin, it's before a PR merge

[20:47] <tellable6> ab5tract, I'll pass your message to melezhik_

[20:48] <ab5tract> not necessarily the normal use case for it, I guess, but it's usually the moment when I want to test the impact of changes

[22:04] *** melezhik_ joined
[22:06] *** melezhik_ left
[23:05] *** melezhik_ joined
[23:07] *** melezhik_ left
[23:31] <[Coke]> aaaand it ran out of memory again - and of course I didn't run it with timo's stuff so it just died at some point while I was afk.

[23:31] <[Coke]> rerunning with the system thing.

[23:42] * [Coke] wonders if it would kill the shell if he ran it OUTSIDE of tmux, or if that's a "feature" of the tmux setup

[23:47] <timo> [Coke]: also check the tmux option "remain-on-exit"

[23:54] *** melezhik_ joined
[23:57] *** melezhik_ left
