[07:25] *** melezhik_ joined
[07:25] <melezhik_> [Coke]: those are modules that failed 

[07:26] <melezhik_> librasteve: let's see, bit busy right now )) thanks for the offer 

[07:27] <melezhik_> ok - brownie 2025.10 finished, this is diff between 2025.11-2025.10 - http://brw.sparrowhub.io/report/brw-reporter/3152 , not many , which is probably good, Proc:Q could be ignored as it's tests are wobbly as the output says 

[07:27] <melezhik_> so we have UpRooted - http://brw.sparrowhub.io/file_view/brw-reporter/engkqulwihdcpmaoxrfy.33/UpRooted.log

[07:28] <melezhik_> LWP::Simple could also be ignored as t/get-perl6-org.t  probably just hit in bad time 

[07:29] <melezhik_> Cro::RPC::JSON - t/060-websocket.rakutest  , probably not rakudo related 

[07:29] <melezhik_> Cache::Async - t/03-expiry.rakutest

[07:35] *** melezhik_ left
[07:35] *** melezhik_ joined
[07:37] *** melezhik_ left
[07:37] *** melezhik_ joined
[08:00] *** melezhik_ left
[08:00] *** melezhik_ joined
[08:18] <melezhik_> [Coke]: ab5tract: patrick: I've added timeouts (10 minutes per zef install Foo ) as guard against long running / infinite modules, please pull the latest version, thanks

[08:36] *** melezhik_ left
[09:38] *** librasteve_ left
[10:13] *** melezhik_ joined
[10:18] <melezhik_> failed modules ( artifacts in sorted order ) - http://brw.sparrowhub.io/report/brw-reporter/3209

[10:30] *** melezhik_ left
[10:30] *** melezhik_ joined
[10:38] *** melezhik_ left
[10:38] *** melezhik_ joined
[10:46] *** melezhik_ left
[12:43] *** melezhik_ joined
[12:50] *** melezhik_ left
[12:50] *** melezhik_ joined
[13:12] *** melezhik_ left
[13:12] *** melezhik_ joined
[13:18] *** melezhik_ left
[13:18] *** melezhik_ joined
[13:24] *** melezhik_ left
[13:24] *** melezhik_ joined
[13:35] *** melezhik_ left
[13:42] *** melezhik joined
[13:44] <melezhik> [Coke]: can we test timeouts on 2025.08 ? Need to pull the latest commit

[13:51] <melezhik> When you can, no rush

[14:43] <[Coke]> seeing a failure on String::Koremutake http 413

[14:43] <[Coke]> melezhik: ok to update the container in place?

[14:44] <[Coke]> did /opt/brownie/agent/upgrade.sh, let me know if I need to do more

[14:48] <melezhik> Yep

[14:49] <melezhik> Let me check

[14:50] <melezhik> Started 2025.08

[14:50] <melezhik> Your agent is up and running , see it‚Äôs pings , it will start receiving load soon 

[15:01] <melezhik> [Coke]: can you please check if there any errors on agent ?

[15:01] <melezhik> Suspiciously only see pings , no reports so far

[15:02] <melezhik> Or probably it‚Äôs just takes some time for the first report

[15:02] <melezhik> Let‚Äôs wait

[15:04] <melezhik> PIDs remain the same and cpu time increases so looks good )

[15:09] <melezhik> Ok , first report had arrived - http://brw.sparrowhub.io/report/job.1.report/3362

[15:19] <[Coke]> +1

[15:20] <melezhik> Ok. 10 minutes timeout exceeded for.     MUGS::UI::WebSimple. http://brw.sparrowhub.io/report/job.1.report/3371

[15:20] <melezhik> Probably need to make a bit bigger

[15:30] <[Coke]> I'd be fine with something even as high as 30 - we just want to avoid stuff like paraseq

[15:45] <[Coke]> Oof, azure bill was a little higher this month (probably due to the windows box I setup for testing)

[16:02] *** librasteve_ joined
[16:52] <melezhik> Oh. Sorry for that

[16:54] <melezhik> Another thing to think about . I don‚Äôt get why some modules successfully pass tests in one Rakudo and the same modules fail to pass tests on another - I doubt it‚Äôs Rakudo impact , reports do not show any reason either . Example - http://brw.sparrowhub.io/file_view/brw-reporter/whjmkpgryanfuobiqexs.8769/Test::Fuzz.log

[16:54] <melezhik> [Test::Fuzz]   Parse errors: Subtest 12 expected 97 but contains 81 tests

[16:55] <melezhik> But why this happens in 2025.10 but does not in 2025.08 ?

[16:55] <melezhik> Or this is just a module test itself flaky , unpredictable, wobbly ?

[16:59] <melezhik> Set timeout to 20

[16:59] <melezhik> https://github.com/melezhik/brownie/commit/0984b1b95efa6f5e24c829890054ca07cc7e7b54

[17:00] <[Coke]> blin has some accomodation for flaky modules - will run it X times to avoid failing on a flapper.

[17:00] <[Coke]> (which is honestly, not something it should hide, it should be considered a soft failure)

[17:10] <melezhik> Yeah. Same thoughts . Will see how can we handle it in brownie . It‚Äôs though not a critical one , as there is still a human who validates reports from brownie and makes a final decision where this is blocker or not

[17:12] <melezhik> Considering comparison does not have too many modules that failed this imho is bearable

[18:05] <melezhik> Rakudo::Options has started to fail since 2025.10 - http://brw.sparrowhub.io/file_view/brw-reporter/lezstpjwmqaoxrnvdgyk.8769/Rakudo::Options.log

[18:05] <melezhik> Failed test 'did we run with -Ilib (2)

[18:08] <[Coke]> That test passes here.

[18:08] <[Coke]> (on my mac with 2025.11)

[18:09] <[Coke]> with 'zef look Rakudo::Options' then 'zef --verbose test .'

[18:11] <melezhik> Interesting

[18:12] <melezhik> Which version of module do you test btw ?

[18:12] <[Coke]> ===> Testing [OK] for Rakudo::Options:ver<0.0.3>:auth<zef:lizmat>

[18:13] <[Coke]> zef look gets you the same one you'd get by doing an install with no version/api/auth info

[18:13] <[Coke]> So, not sure if it's because of how brownie is setting things up for the test.

[18:13] <[Coke]> or if it works on mac and not linux?

[18:14] <[Coke]> (didn't install deps because it doesn't have any)(

[18:14] <melezhik> ok $ro.includes, 'did we run with -Ilib (1)';

[18:14] <melezhik> Yeah . Worth try on Linux

[18:15] <melezhik> Also brownies does the same . zef look && zef install ‚Äîdeps-only . && zef ‚Äîverbose test .

[18:16] <[Coke]> tried it inside the agent's container.

[18:16] <melezhik> Yeah

[18:16] <[Coke]> ... and zef look fails.

[18:16] <melezhik> You need to unset ZEF_INSTALL_TO

[18:17] <melezhik> ah, you still need to do that , but this is not relevant

[18:17] <[Coke]> having it blank is not sufficient?

[18:18] <melezhik> It shouldn‚Äôt be blank

[18:18] <[Coke]> yah, same result.

[18:18] <[Coke]> I just did an exec bash to get in the container. env showed 'ZEF_INSTALL_TO=' - I unset it it, ran it again, same error

[18:19] <[Coke]> Looks like we're also several releases of raku behind.

[18:27] *** melezhik_ joined
[18:27] <melezhik_> https://gist.github.com/melezhik/587c356b9f3de8eba0307a6f98940fbb

[18:29] <melezhik> I guess zef look probably does not work as expected , I just took it‚Äôs output ( name of temp dir ) and cd to the dir explicitly

[18:29] <melezhik> This is basically the same what sparrow plugin does , do not know why it does not work strut away via cli

[18:30] <melezhik> Anyway zef ‚Äîverbose test . passes

[18:31] <melezhik> Several release of Raku behind ?

[18:33] *** melezhik_ left
[18:33] <melezhik> https://www.irccloud.com/pastebin/2jvsGdca

[18:34] <[Coke]> the container is using 2025.08, no?

[18:34] <melezhik> The error I am talking about started in 2025.10

[18:35] <[Coke]> docker exec -it agent raku --version

[18:35] <[Coke]> Welcome to Rakudo‚Ñ¢ Star v2025.08.

[18:35] <melezhik> Container had some default Rakudo , but brownie uses whatever able Rakudo by setting   PATH

[18:35] <melezhik> Exactly what I did in gist

[18:36] <melezhik> For example

[18:36] <melezhik> export PATH=/tmp/whateverable/rakudo-moar/fe0e20c28859ea709eefad19af452c9d35dff20d/share/perl6/site/bin/:/tmp/whateverable/rakudo-moar/fe0e20c28859ea709eefad19af452c9d35dff20d/bin//:$PATH

[18:36] <[Coke]> Yes, I understand you're not using that raku to run the tests.

[18:37] <melezhik> But the problem is when I run the same way zef test for Rakudo::Options inside container - it passes . Wait a sec - I did it on Mac OS as well as

[18:37] <melezhik> Need to check on Linux

[18:37] <melezhik> My laptop battery flat right now

[18:39] <melezhik> ‚Äú9:36 PM <[Coke]> Yes, I understand you're not using that raku to run the tests.‚Äù Yep . Basically if you repeat steps from gist ‚Ä¶ on Linux agent , but your is Mac as well , right? ))

[18:40] <melezhik> So need to check on Linux ))

[18:48] *** melezhik_ joined
[18:55] <melezhik_> let me probably reconsider my initial idea, Mac OS VS Linux is not relevant, as we run inside container with Debian anyway

[18:58] <[Coke]> my test on the mac had nothing to do with the container and used latest raku

[19:00] <melezhik_> ok, I mean I tested actually inside agent container which is Debian Linux and test passed

[19:06] <melezhik_> run Rakudo::Options test THE SAME way as brownie agent does and it also passes - https://gist.github.com/melezhik/ed8dafc72ae01fb9e3a07d69b4c1ea2e

[19:06] <melezhik_> which makes me think that maybe Rakudo::Options is flaky, or maybe brownie makes it flaky somehow ...

[19:07] <melezhik_> can you bash exec to your agent and run the same ? basically just `s6 --task-run .@rakudo_version=fe0e20c28859ea709eefad19af452c9d35dff20d,module=Rakudo::Options`

[19:07] <melezhik_> from /opt/brownie/agent/tasks/run-test directory 

[19:08] <melezhik_> I wonder what will we get 

[19:11] <lizmat> fwiw, Rakudo::Options tests clean on my Mac with HEAD

[19:11] <melezhik_> Ok https://github.com/lizmat/Rakudo-Options/issues/1

[19:12] <melezhik_> could this somehow relate to this flaky behavior ?

[19:13] <melezhik_> dunno ü§∑‚Äç‚ôÇÔ∏è 

[19:15] *** melezhik_ left
[19:15] *** melezhik_ joined
[19:15] <melezhik_> raku -MRakudo::Options -e 'say $*RAKUDO-OPTIONS'

[19:15] <melezhik_> Rakudo::Options.new(includes => [], modules => ["Rakudo::Options"], ll-exception => Empty, stagestats => Empty, n => Empty, p => Empty, e => "say \$*RAKUDO-OPTIONS", executable => "/tmp/whateverable/rakudo-moar/fe0e20c28859ea709eefad19af452c9d35dff20d/bin/rakudo", program => ("-e", "say \$*RAKUDO-OPTIONS"), profile => Empty, optimize => Empty, encoding => Empty, target => Empty)

[19:15] <melezhik_> I wonder how this passes https://github.com/lizmat/Rakudo-Options/blob/b601f916193d5a05dd90211d8cc7a9aa7bd29edf/t/01-basic.rakutest#L10-L11

[19:18] <melezhik_> intersting if run as `raku t/01-basic.rakutest` it fails - https://gist.github.com/melezhik/8d815d234c12e77bd10842a196368929

[19:18] <melezhik_> ^^ lizmat:

[19:19] <melezhik_> I guess I should have run as raku -I lib ?

[19:21] <melezhik_> or raku -I .

[19:22] <melezhik_> my guess is only that - this somehow SOMETIMES does not happen during zef --verbose test . and I dunno why 

[19:23] <lizmat> yeah, it expects to be run with -Isomething  and without -Msomething

[19:24] <lizmat> but it isn't particular about what is specified with -I

[19:24] <melezhik_> ok another interesting finding 

[19:24] <melezhik_> I managed to reproduced that

[19:25] <melezhik_> I fails under SYSTEM, not whateverable  rakudo

[19:25] <melezhik_> let me share gist

[19:27] <melezhik_> https://gist.github.com/melezhik/97eb2ed7d70ed25973cc0c5e372a2c6e

[19:28] <melezhik_> but this one is v2025.10 Rakudo‚Ñ¢ Star bundle 

[19:28] <melezhik_> I guess somehow is different from  Rakudo‚Ñ¢  

[19:35] <lizmat> that gist shows the same 2 tests failing, because apparently they're being run without -I ??

[19:35] <melezhik_> the only question what is left, why it SOMETIMES also fails under whatevearble rakudo, as shown here - http://brw.sparrowhub.io/file_view/brw-reporter/lyofvjmkprtxhzcagsbn.8769/Rakudo::Options.log

[19:36] <lizmat> that shows an empty page for me

[19:36] <melezhik_> ` because apparently they're being run without -I ??` - probably right, but tests are run via standard zef --verbose test .

[19:36] <melezhik_> and my assumption that it should take care about -I lib / -I .

[19:37] <lizmat> zef test --verbose .      passes for me on HEAD

[19:37] <melezhik_> https://gist.github.com/melezhik/39a052d4fe544b38a42ffb9dc65587d8

[19:37] <melezhik_> you can use this link

[19:38] <melezhik_> anyways - it falls under Rakudo Start bundle, rakudo version 2025.11

[19:38] <melezhik_> here - https://gist.github.com/melezhik/97eb2ed7d70ed25973cc0c5e372a2c6e

[19:39] <melezhik_> so it's not a Rakudo::Options issue I guess, but zef bundled into Rakudo Start

[19:39] <melezhik_> because exactly under this zef we have an issue 

[19:40] *** melezhik_ left
[19:40] *** melezhik_ joined
[19:41] <lizmat> I'll make a new Rakudo::Options release without the -I test shortly, just to be on the safe side  :-)

[19:41] <lizmat> afk&

[19:44] <melezhik_> liz - sure, no rush

[19:46] <melezhik_> lizmat: [Coke]: - another interring finding Rakudo::Options is only reproduced on flamboyant-moore-63797432 agent (the one bug guns agent running by patrickb:) , but not on coke agent and not on my local agent

[19:46] <melezhik_> which makes me think that this is agent related issue

[19:48] <melezhik_> patrickb: could you please run following on your agent  and run this `cd /opt/brownie/agent/tasks/run-test/ && s6 --task-run .@rakudo_version=fe0e20c28859ea709eefad19af452c9d35dff20d,module=Rakudo::Options`

[19:48] <melezhik_> I have some filling the issue will be reproduced ( please share the output here via Pastebin or gist )

[19:51] <melezhik_> http://brw.sparrowhub.io/file_view/brw-reporter/lyofvjmkprtxhzcagsbn.8769/Rakudo::Options.log - see [agent] for failed (rakudo 2025.11) and for passed ( old - rakudo 2025.08)

[19:52] <melezhik_> the same http://brw.sparrowhub.io/file_view/brw-reporter/natujmohivesxzqflybw.8769/Rakudo::Options.log - test passed on coke bot agent  ( with rakudo 2025.08) and fails on Patricks agent (flamboyant-moore-6 rakudo 2025.10)

[19:58] <melezhik> Also if your agent has anything in bashrc and or bash profile related to Raku / zef env vars this is also will be valuable , thanks

[20:07] <melezhik> patrickb: the last question do you run agent with - BRW_AGENT_CAP_INSTALL_FROM_SOURCE_FORCE=1 ?

[20:08] <melezhik> If so this force to install Rakudo/zef  from source for commit rather then use whatever able binary

[20:09] <melezhik> And this may end up in different behavior with regards to automatic including -I lib or -I .

[20:09] <melezhik> https://github.com/melezhik/brownie/blob/5a76c97ff86103e196ec30388a850b333416544d/agent/run.sh#L7

[20:10] <melezhik> This option only required if someone runs agent on none x86-64 boxes

[20:12] <melezhik> Installing from the source logic is here - https://github.com/melezhik/brownie/blob/main/agent/tasks/install-rakudo-from-source/task.bash

[20:20] <melezhik> I did quick analysis of diffs between Rakudo 2025.11 vs 2025.10 and Rakudo 2025.10 vs 2025.08 , interesting many tests failures happend on flamboyant-moore-63797432 agent

[20:20] <melezhik> And on the same modules passed on Coke bot agent

[20:20] <melezhik> http://brw.sparrowhub.io/file_view/brw-reporter/yqwnutzsvfmohgcpiedx.8769/Test::Fuzz.log

[20:21] <melezhik> As example

[21:33] *** melezhik_ left
[21:33] *** melezhik_ joined
[21:39] *** melezhik_ left
[21:39] *** melezhik_ joined
[22:45] <lizmat> fwiw, 0.0.4 of Rakudo::Options just uploaded to fez

[22:46] *** melezhik_ left
[22:46] *** melezhik_ joined
[22:51] *** melezhik left
