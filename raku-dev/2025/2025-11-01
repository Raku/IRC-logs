[00:44] *** gfldex left
[00:50] *** vrurg joined
[00:50] *** gfldex joined
[00:56] *** greppable6 left
[00:56] *** unicodable6 left
[00:56] *** vrurg_ left
[00:56] *** [Coke] left
[00:56] *** committable6 left
[00:56] *** unicodable6 joined
[00:56] *** greppable6 joined
[00:56] *** [Coke] joined
[00:56] *** committable6 joined
[01:19] *** melezhik left
[03:08] *** ntv left
[03:10] *** apogee_ntv joined
[08:59] <[Tux]> Rakudo v2025.10-27-g89dff65d3 (v6.d) on MoarVM 2025.10-11-g06c0bcbb7

[08:59] <[Tux]> csv-test-xs         0.014 -  0.014

[08:59] <[Tux]> csv-test-xs-20      0.116 -  0.117

[08:59] <[Tux]> csv-ip5xs           0.263 -  0.266

[08:59] <[Tux]> test-t --race       0.283 -  0.291

[08:59] <[Tux]> test-t              0.462 -  0.473

[08:59] <[Tux]> csv-ip5xs-20        1.102 -  1.103

[08:59] <[Tux]> csv-parser          1.139 -  1.140

[09:00] <[Tux]> test-t-20 --race    1.473 -  1.532

[09:00] <[Tux]> test                1.851 -  1.930

[09:00] <[Tux]> test-t-20           5.883 -  6.001

[09:00] <[Tux]> https://tux.nl/Talks/CSV6/speed4-20.html / https://tux.nl/Talks/CSV6/speed4.html https://tux.nl/Talks/CSV6/speed.log

[09:16] *** melezhik joined
[10:00] *** librasteve_ joined
[13:21] *** ds7832 joined
[13:33] <timo> ok, i'm back on the parallel module loading topic. i think i understand how the part i was unsure about works

[13:35] *** melezhik_ joined
[13:35] <melezhik_> timo: ++

[13:35] <timo> i think i'm going to procedurally generate a ridiculous module with lots of modules that have a bunch of different dependency paths through all the bits and random sleeps in the module mainlines and such

[13:35] <melezhik_> if you want to experiment with brownie in that sense, just give me a shout 

[13:36] <timo> brownie may be a few levels too high up for my needs right now

[13:38] <melezhik_> yeah, I see

[13:46] *** melezhik_ left
[14:06] *** melezhik_ joined
[14:09] *** melezhik_ left
[14:34] *** melezhik_ joined
[14:35] *** melezhik_ left
[14:36] *** melezhik left
[14:46] *** melezhik_ joined
[14:48] *** melezhik joined
[14:57] *** librasteve_ left
[15:01] *** melezhik_ left
[15:01] *** melezhik_ joined
[15:04] <melezhik_> .

[15:20] *** melezhik_ left
[15:20] *** melezhik_ joined
[15:23] <timo> whatever i did made compilation errors during dependency precomp make the main process hang (probably only if other threads are waiting for precomp to finish)

[15:32] *** melezhik_ left
[15:42] *** melezhik_ joined
[15:44] *** melezhik_ left
[15:52] <timo> actually that may have already been there before

[15:58] *** melezhik_ joined
[16:02] *** melezhik_ left
[16:13] *** melezhik_ joined
[16:19] *** melezhik_ left
[16:19] *** melezhik_ joined
[16:21] <timo> huh. "say" or "note" inside a BEGIN block in a file that gets precomped can break because looking up &say and &note result in VMNull somehow, and trying to invoke that breaks ... but the issue doesn't seem to appear without --stagestats or RAKUDO_MODULE_DEBUG=1

[16:21] <timo> oh, huh, just running the file itself manually also causes this problem? without any flags or env vars?

[16:23] <ugexe> ah

[16:23] <ugexe> there is some ipc via stderr/stderr

[16:25] <timo> is this a known issue? or did i somehow break it with my changes? i'll rebuild rakudo on main i guess

[16:26] <timo> i thought it was only stdout

[16:26] <timo> for the dependencies, right?

[16:26] <ugexe> https://github.com/rakudo/rakudo/blob/89dff65d399251432fb2d2a7a38eb3ed701af76d/src/core.c/CompUnit/PrecompilationRepository.rakumod#L428

[16:26] <ugexe> around here and after

[16:26] <timo> .o( if we had proper filehandle inheritance control for &run and Proc::, we could keep stdout and stderr free for the user to use )

[16:26] <ugexe> but yeah i think it passes the depenencies through

[16:27] <ugexe> and rakudo_module_debug being on/off changes something about stderr and/or stdout that gets used (sorry for being vague, i forget the details)

[16:27] <ugexe> https://github.com/rakudo/rakudo/blob/89dff65d399251432fb2d2a7a38eb3ed701af76d/src/core.c/CompUnit/PrecompilationRepository.rakumod#L447-L451

[16:27] <ugexe> probably related to that bit

[16:28] <ugexe> i don't think there is a proper issue for it though

[16:29] <timo> that would explain why setting RAKUDO_MODULE_DEBUG causes something to happen, but --stagestats also causes the issue

[16:29] <ugexe> yeah and here is another RMD change of behavior right around there https://github.com/rakudo/rakudo/blob/89dff65d399251432fb2d2a7a38eb3ed701af76d/src/core.c/CompUnit/PrecompilationRepository.rakumod#L469-L471

[16:30] <timo> i think that's too far away from the thing i'm seeing

[16:31] <timo> i literally saw getlex_no '&say' return a VMNull

[16:31] <timo> inside of my BEGIN block

[16:32] <timo> oh no, the error goes away when i build from rakudo main ;_;

[16:37] <timo> was it a fluke? i can't get it reproduced any more it looks like

[16:53] *** melezhik_ left
[16:53] *** melezhik_ joined
[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: 002dac33e2 | (Timo Paulssen)++ | src/core.c/CompUnit/Repository/FileSystem.rakumod

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: When precomp fails, notify waiting threads of failure

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: 

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: Otherwise, multiple threads requiring the same compunit,

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: that then first has to be precompiled, and fails to compile for

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: some reason, will keep waiting forever for the Promise to be

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: broken or kept.

[16:55] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: review: https://github.com/rakudo/rakudo/commit/002dac33e2

[16:56] *** melezhik left
[16:59] <timo> i should have made the branch name shorter

[17:03] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: 040d145a44 | (Timo Paulssen)++ | src/core.c/CompUnit/PrecompilationRepository.rakumod

[17:03] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: in !load-dependencies, handle loaded hash right

[17:03] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: 

[17:03] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: need to not just check that there is something in a slot, but now

[17:03] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: we can also have Promise objects in there that we need to await.

[17:03] <Geth> ¦ rakudo/precomp_repo_no_parallel_load_of_same_precompiled_file: review: https://github.com/rakudo/rakudo/commit/040d145a44

[17:16] *** melezhik_ left
[17:38] <timo> hm, i cannot recommend running the stresstest thing with 500 modules and four rakudos in parallel trying to precomp everything

[17:38] <timo> the ram usage is rather a lot

[18:22] <timo> https://gist.github.com/timo/c206a75790f5571912382f133d788c99

[18:22] <timo> i reduced the max number of dependencies a module can have on something in the next sphere to 6 instead of "as much as there are modules in there" which makes the growth from the recursiveness a lot less ridiculous

[18:28] <timo> lizmat: responded to your comment on my PR, does it clear up the question?

[18:32] <timo> hmm. that isn't actually crashy with rakudo on main branch

[18:34] <lizmat> it answers my question: but perhaps explain that in a comment there

[18:37] *** melezhik_ joined
[18:50] *** melezhik_ left
[18:50] *** melezhik_ joined
[18:55] *** melezhik_ left
[18:55] *** melezhik_ joined
[18:59] <timo> i feel like "otherwise the dependency precomp has already been loaded and we can just go on" is like what i explained

[19:04] *** melezhik_ left
[19:05] *** melezhik_ joined
[19:08] <melezhik_> finally solved the problem with output buffering and now o10r main page gets realtime data over web socket (every 2 minutes)

[19:08] <melezhik_> http://brw.sparrowhub.io/report/brw-orch/2058

[19:08] <melezhik_> ^^ ab5tract:

[19:17] *** melezhik_ left
[19:59] <lizmat> timo: yeah, you're right.  Didn't make the link between "we've promised" and "returned a Promise" in my head  :-(

[20:14] <lizmat> weekly: time to think about the Raku Advent Calendar!

[20:14] <notable6> lizmat, Noted! (weekly)

[20:16] *** ds7832 left
[20:37] *** melezhik_ joined
[20:41] *** melezhik_ left
[20:44] *** ds7832 joined
[22:02] *** vrurg left
[22:14] *** melezhik_ joined
[22:16] *** melezhik_ left
[22:17] *** melezhik_ joined
[22:20] *** vrurg joined
[22:21] *** melezhik_ left
[23:18] *** melezhik_ joined
[23:22] *** melezhik_ left
[23:50] *** melezhik_ joined
[23:54] *** melezhik_ left
[23:55] *** melezhik_ joined
[23:57] *** melezhik_ left
