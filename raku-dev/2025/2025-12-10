[01:41] *** Pixi` joined
[01:44] *** Pixi left
[01:51] *** Pixi__ joined
[01:51] *** [Coke]_ joined
[01:56] *** lucs_ joined
[02:00] *** Pixi` left
[02:00] *** quotable6 left
[02:00] *** committable6 left
[02:00] *** evalable6 left
[02:00] *** lucs left
[02:00] *** notable6 left
[02:00] *** linkable6 left
[02:00] *** coverable6 left
[02:00] *** greppable6 left
[02:00] *** sourceable6 left
[02:00] *** [Coke] left
[02:00] *** unicodable6 left
[02:03] *** evalable6 joined
[02:03] *** greppable6 joined
[02:03] *** sourceable6 joined
[02:03] *** linkable6 joined
[02:03] *** committable6 joined
[02:03] *** notable6 joined
[02:03] *** quotable6 joined
[02:39] *** [Coke]_ is now known as [Coke]

[03:51] *** melezhik_ left
[05:43] *** melezhik joined
[07:14] <melezhik> Ok. Run Rakudo::Options 0.0.3 on Rakudo 2025.11 compiled from source code , it passes the tests. So looks my theory on compile from source relation does not confirm .

[07:15] <melezhik> Bug is still reproducible for Rakudo::Options 0.0.3 if run under Rakudo star bundle 2025.11

[07:16] <melezhik> Rakudo::Options 0.0.4 passes tests as well, but I have not tried it with Rakudo star , will do later

[07:16] <melezhik> Still waiting information from patrickb on his agent environment

[08:00] <patrickb> melezhik: Literal screenshot: https://imgur.com/a/s2uYexT

[08:02] <patrickb> melezhik: I did not modify the run.sh apart from s/docker/podman/ and the threads up to 19. Thus I do have the BRW_AGENT_CAP_INSTALL_FROM_SOURCE_FORCE=1 set.

[08:03] <patrickb> I did not modify the environment. It's the vanilla debian env.

[08:06] <patrickb> I've added a screenshot of run.sh and the env to the same URL.

[08:09] <patrickb> My first guess as to why things don't behave identical everywhere is timing. That same behavior also sometimes shows in our CI. It fails reliably in the CI but passes on most end user machines. The reason is often: The CI is a lot slower.

[08:20] <melezhik> Yeah. It could be timing , but Rakudo::Options error is of rather logical rather than timing nature ‚Ä¶. Hold on )) your screen shot shows sparrow task uses default ( system Rakudo ) not whateverable one as it should , the test passes now , but just because lizmat has fixed in 0.0.4

[08:33] <patrickb> I'm tracking down an issue in PR #5060. "Cannot find symbol GLOBAL in CORE.d". Can someone give me a primer on what GLOBAL is and how it's bootstrapped? I observe that error in code called from World.comp_unit_stage0.

[08:34] <patrickb> It happens when trying to install zef during the "Staging" phase.

[08:37] <melezhik> Ok, I guess this is just because you run this one before Rakudo was installed in agent

[08:54] <patrickb> Actually I guess I'd be fine to just do it in RakuAST instead. (Where there is no World, right?) I then probably also need a few pointers.

[09:12] <lizmat> perhaps nine could give some  :-)

[09:16] <patrickb> The CompUnit/Repository stuff is not yet supported in RakuAST, correct? (I wonder, because there is a usage of World in RepositoryRegistry.resolve-unknown-repos)

[09:18] <lizmat> ah, indeed...  ok, I guess that would need to be fixed in 6.e

[09:18] <lizmat> which would also be a chicken/egg problem  :-(

[09:38] <ab5tract> patrickb:last I checked all mentions of $*W are actually properly accounted for

[09:40] <patrickb> https://github.com/rakudo/rakudo/blob/main/src/core.c/CompUnit/RepositoryRegistry.rakumod#L347

[09:40] <patrickb> that's the line

[09:40] <ab5tract> patrickb: the construction of pseudo stashes is different in 6.e, you are looking for PsuedoStash.rakumod

[09:41] <ab5tract> (One of those files for 6.e, the other for earlier versions)

[09:41] <ab5tract> patrickb: but its potential absence is accounted for here https://github.com/rakudo/rakudo/blob/6b47541e27a4a0bcc9bbc07cdbf944b7174cc01c/src/core.c/CompUnit/RepositoryRegistry.rakumod#L361

[09:42] <ab5tract> lizmat: did we ever get around to parallelizing the feed operators?

[09:43] <lizmat> I made a gist and/or a PR for it...

[09:43] <ab5tract> Eek

[09:43] <ab5tract> I will claim I must have been hibernating to miss it

[09:44] <patrickb> oh interesting. the find_single_symbol in that very line is the call that fails with "GLOBAL not found in CORE.d"

[09:45] <patrickb> So This issue might already be gone in RAST. \o/

[09:47] <patrickb> Am I already able to install zef and other modules with RAST?

[09:47] <ab5tract> No

[09:47] <ab5tract> :(

[09:47] <ab5tract> There is a package name resolution problem that blocks make install

[09:48] <ab5tract> I believe it also is related to failures with zef

[09:48] <ab5tract> But please feel free to dig into the zef side of things

[09:49] <lizmat> https://gist.github.com/lizmat/8652e4a403fffe64e84b392b31cc6ad4    6 years ago

[09:56] <ab5tract> Well I was born yesterday, that explains it ;)

[09:58] <ab5tract> I wonder if fully converting the feed stuff in RakuAST away from its current QAST heavy approach would allow for this solution or even an AST based approach to work

[10:17] <ab5tract> Not that this doesn‚Äôt already work, I just mean maybe we could more or less rewrite this as AST. Then the eventual optimizer might be able to do intelligent things?

[10:33] <patrickb> ab5tract: So I compile a Rakudo as usual, then with RAKUDO_RAKUAST=1 run `raku -I. bin/zef install .` and see what breaks, correct?

[10:34] <lizmat> probably need to make sure .precomp is empty / doesn't exist as well

[11:32] *** melezhik left
[11:39] <ab5tract> patrickb: that should do it :) (per lizmat‚Äôs suggestion)

[11:41] *** librasteve_ left
[13:28] <patrickb> https://paste.sr.ht/~patrickb/abaf0e890d72734df56e0703fd225c0d798cfa19

[13:29] <patrickb> Is this the known RAST install error?

[13:36] <lizmat> that *feels* like the error that broke Hash::Ordered, are you sure you are on HEAD patrickb ?

[13:37] <lizmat> otoh, it could be that zef has an issue with roles that RakuAST is more picky about

[13:41] <patrickb> yes, that's head

[13:50] <lizmat> perhaps change line 192 to: but my role :: { .... } ?

[13:50] <lizmat> just for debugging

[13:51] <lizmat> if that fixes it, then I assume that RakuAST has a bug for nameless roles being "our" scoped rather than "anon" scoped 

[13:52] <lizmat> or maybe:    but anon role { ... }

[14:02] <patrickb> That gives a new error. So it indeed seems to fix the issue.

[14:02] <patrickb> New error: https://paste.sr.ht/~patrickb/78bf7cdc26910afd639333d12582103f2e32e2e6

[14:02] *** librasteve_ joined
[14:04] <patrickb> Let me see if I'm able to locate the place where the scope for unnamed roles is set...

[14:05] <lizmat> fwiw, I think simply doing:  RAKUDO_RAKUAST=1 raku lib/Zef.rakumod

[14:05] <lizmat> will show the error

[14:05] <lizmat> as it really is a compilation issue with Zef itself in RakuAST

[14:09] *** melezhik joined
[14:48] <melezhik> Ok. patrickb [Coke] could you please pull the latest commit and upgrade agents . I am investigating those failing tests that appear in comparison reports and seems some of them if not many are due to subtle issue which leads to usage of default Rakudo instead of whateverabke 

[14:48] <melezhik> Whateverable

[14:49] <melezhik> This at least explains issue with Rakudo::Options and some other modules

[14:50] <melezhik> Still dunno ü§∑ how this happens

[14:50] <melezhik> When default Rakudo star bundle zef/rakudo is used for tests

[14:51] <melezhik> Now this should not happen by design - https://github.com/melezhik/brownie/blob/dd319c38554509fc9bdf92fa80fcb8ef0de631cc/agent/tasks/zef-test/task.bash#L49

[14:52] <melezhik> Interesting why some modules fail to test under Rakudo star bundle

[14:53] <melezhik> Rakudo::Options 0.0.3 , Hashids

[14:57] <melezhik> Test::Fuzz

[14:57] <melezhik> They all do not pass tests under Rakudo Star 2025.10

[15:31] <[Coke]> git pull, rebuild, hard restart.

[16:45] <melezhik> Ahhh, forgot to numb agent Version, but if you pull the latest , this should be fine

[16:47] <melezhik> Bump

[16:48] <lizmat> .oO( are we sure the agents are agenting on their own free will ?  :-)

[17:14] <[Coke]> restarted

[18:08] <melezhik> [Coke]: ++

[18:09] <melezhik> lizmat: ))

[18:10] <melezhik> patrickb: please update your agent when you can , thanks üôè

[18:48] <[Coke]> https://cro.raku.org/training-support - this is out of date, yes?

[18:53] <melezhik> Hm , Coke-agent jobs are sort of stuck - https://gist.github.com/melezhik/dab288f132a68abfd7559711042417ad

[18:54] <melezhik> Though I set timeouts ‚Ä¶ hm

[18:55] <melezhik> ps aux | grep timeout

[18:57] <[Coke]> shows one timeout 20m one timeout 10m job.

[18:58] <[Coke]> er, 2-3 depending.

[19:02] <melezhik> Ok, then timeout should do their jobs soon or later

[19:03] <melezhik> Ok. Report has arrived 

[19:03] <melezhik> New jobs have started , looks good

[19:08] <melezhik> Fixed timeout abit 10m -> 20m

[19:23] <[Coke]> https://github.com/croservices/cro/ - is this the right repo for cro these days?

[19:23] <[Coke]> If so, can someone add me as a ticket admin or something?

[19:24] <[Coke]> melezhik, for example has https://github.com/croservices/cro/issues/144 which is old and not a cro issue.

[19:29] <[Coke]> (actually, just add me to the org, if possible)

[19:29] <[Coke]> (rather than one repo)

[19:36] <[Coke]> Also, someone please re-open https://github.com/croservices/cro/issues/158, I misclicked close. :(

[19:39] *** melezhik_ joined
[19:41] <melezhik_> lizmat: here is an example of failing Rakudo::Options:ver<0.0.3> on Rakudo Star 2025.10 and passing on Rakudo 2025.10 whateverable. Seems strange to me  - https://gist.github.com/melezhik/ae37a01347a3a2c711cebc7fb4c451fa

[19:48] *** melezhik_ left
[19:49] *** linkable6 left
[19:49] *** notable6 left
[19:49] *** notable6 joined
[19:49] *** linkable6 joined
[19:50] *** quotable6 left
[19:50] *** quotable6 joined
[20:10] <[Coke]> do cro tickets get announced anywhere?

[20:14] *** Geth__ joined
[20:14] * lizmat kicks Geth just to be on the safe side

[20:18] *** Geth left
[20:21] *** Geth__ left
[20:21] *** Geth joined
[20:26] <lizmat> I don't think we actually announce issue creation?

[20:28] *** rakkable left
[20:29] *** rakkable joined
[20:35] <[Coke]> at all? OK.

[21:12] *** melezhik left
[22:03] <[Coke]> had to restart docker here, melezhik.

[22:03] <[Coke]> (reboot the laptop, actually)

[22:25] <Geth> ¬¶ rakudo: patrickbkr++ created pull request #6038: Default unnamed packages to `my` scope instead of `our`

[22:25] <Geth> ¬¶ rakudo: review: https://github.com/rakudo/rakudo/pull/6038

[22:26] <patrickb> lizmat: I've created a minimal patch to default unnamed packages to `my`. That fixes this issue. But trying to set it to `anon` instead (which I find more logical) gives "Cannot use 'anon' with role declaration".

[22:26] <patrickb> https://github.com/rakudo/rakudo/pull/6038

[22:36] <patrickb> Next up: No such method 'meta-object' for invocant of type

[22:36] <patrickb> 'RakuAST::Declaration::Import'

[22:37] <patrickb> I'm off for today. o/

[22:51] <[Coke]> o/

