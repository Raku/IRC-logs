[01:05] *** librasteve_ left
[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: 86c0afef6c | dependabot[bot]++ (committed using GitHub Web editor) | package-lock.json

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: Bump glob from 10.4.5 to 10.5.0

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: 

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: Bumps [glob](https://github.com/isaacs/node-glob) from 10.4.5 to 10.5.0.

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: - [Changelog](https://github.com/isaacs/node-glob/blob/main/changelog.md)

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: - [Commits](https://github.com/isaacs/node-glob/compare/v10.4.5...v10.5.0)

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: 

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: ---

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: <…commit message has 7 more lines…>

[02:33] <Geth> ¦ setup-raku/dependabot/npm_and_yarn/glob-10.5.0: review: https://github.com/Raku/setup-raku/commit/86c0afef6c

[02:33] <Geth> ¦ setup-raku: dependabot[bot]++ created pull request #44: Bump glob from 10.4.5 to 10.5.0

[02:33] <Geth> ¦ setup-raku: review: https://github.com/Raku/setup-raku/pull/44

[03:45] *** disbot1 left
[03:45] *** disbot2 joined
[05:30] *** melezhik joined
[09:12] <Geth> ¦ setup-raku: bf6cff2081 | dependabot[bot]++ (committed using GitHub Web editor) | package-lock.json

[09:12] <Geth> ¦ setup-raku: Bump glob from 10.4.5 to 10.5.0 (#44)

[09:12] <Geth> ¦ setup-raku: 

[09:12] <Geth> ¦ setup-raku: Bumps [glob](https://github.com/isaacs/node-glob) from 10.4.5 to 10.5.0.

[09:12] <Geth> ¦ setup-raku: - [Changelog](https://github.com/isaacs/node-glob/blob/main/changelog.md)

[09:12] <Geth> ¦ setup-raku: - [Commits](https://github.com/isaacs/node-glob/compare/v10.4.5...v10.5.0)

[09:12] <Geth> ¦ setup-raku: 

[09:12] <Geth> ¦ setup-raku: ---

[09:12] <Geth> ¦ setup-raku: <…commit message has 8 more lines…>

[09:12] <Geth> ¦ setup-raku: review: https://github.com/Raku/setup-raku/commit/bf6cff2081

[09:37] *** librasteve_ joined
[12:11] <ab5tract> fascinating! so CurriedRoleHOW.type_check is never called on assignment to a typed container when RAKUDO_RAKUAST=1

[12:11] <ab5tract> so maybe there is an overly zealous guard in RakuAST somewhere...

[12:16] *** melezhik left
[12:35] <ab5tract> Looks like CurriedRoleHOW.type_check is only called in the optimizer :o

[12:35] <ab5tract> why is the optimizer still running when I do --optimize=0 though?

[12:39] <ab5tract> I don't see anything relevant in the docs either.. plz halp

[12:41] <lizmat> and with --optimize=  ??

[12:41] <lizmat> "0" is true

[12:41] <ab5tract> right but it is listed as an option in the --help

[12:42] <ab5tract> same thing with `--optimize=`

[12:47] <lizmat> hmmm

[12:47] <lizmat> perhaps timo has an idea

[12:53] *** librasteve_ left
[12:57] <timo> there's a difference between --optimize=off and --optimize=0 where --optimize=0 still does the correctness checks it can do

[13:04] <ab5tract> ah, `off` doesn't appear in `--help`

[13:04] *** melezhik joined
[13:05] <ab5tract> that does what I want :)

[13:06] <Geth> ¦ rakudo/main: 04a36dd13d | ab5tract++ | src/Perl6/Compiler.nqp

[13:06] <Geth> ¦ rakudo/main: Adjust CLI help to mention --optimize=off

[13:06] <Geth> ¦ rakudo/main: review: https://github.com/rakudo/rakudo/commit/04a36dd13d

[13:07] <ab5tract> it turned out to be a false positive anyway.. lots of `type_check` calls in the optimizer stage but none once the script's code is actually running

[13:08] <ab5tract> just when I thought I had caught a lucky break

[13:15] <ab5tract> CurriedRoleHOW.new_type calls `nqp::settypecheckmode` with `nqp::const::TYPE_CHECK_NEEDS_ACCEPTS`

[13:16] <ab5tract> shouldn't that enforce a runtime call to (at least) `CurriedRoleHOW.accepts_type` ?

[13:55] *** librasteve_ joined
[14:45] <ab5tract> interesting...

[14:48] <ab5tract> m: role R[::T] { has @.a is Array[T] }; my $ri = R[Int].new; use nqp; dd nqp::istype($ri.a.WHAT,Array[Int])

[14:48] <camelia> rakudo-moar 04a36dd13: OUTPUT: «1␤»

[14:48] <ab5tract> m: Q| role R[::T] { has @.a is Array[T] }; my $ri = R[Int].new; use nqp; dd nqp::istype($ri.a.WHAT,Array[Int]) |.AST.EVAL

[14:48] <camelia> rakudo-moar 04a36dd13: OUTPUT: «Could not instantiate role 'R'; exception details:␤␤    Unknown compilation input 'qast'␤      in any IMPL-COMPILE-DYNAMICALLY at src/Raku/ast/code.rakumod line 429␤      in any  at src/Raku/ast/code.rakumod line 148␤      in sub  at src/Rak…»

[14:49] <ab5tract> uh, that's strange. I just get a `0` for that code locally

[14:51] <ab5tract> right, because it is Array[T] ..

[16:10] <timo> ab5tract: are you wary of automatic punning if you're not handling these objects really carefully? i'm not sure if that's even relevant, just a thought

[16:26] *** melezhik left
[17:09] <lizmat> so is "fez remove" supposed to work now ??

[17:12] *** melezhik joined
[18:18] <ab5tract> I think I've narrowed it down to a difference in how the grammar handles parametric types from the setting vs those declared in user code: https://gist.github.com/ab5tract/da93dea39dec512076478451f5c253fa

[18:19] <ab5tract> nine: if you have a moment, I'd be curious whether you think that I am onto anything here

[18:28] *** finanalyst joined
[19:07] <ab5tract> ok.. that appears to be a false start. or at least, changing how that behaves didn't fix anything

[19:11] <ab5tract> m: role R[::T] { has Array[T] $.t }; dd R[Int].new: t => [5]

[19:11] <camelia> rakudo-moar 04a36dd13: OUTPUT: «Type check failed in assignment to $!t; expected Array[Int] but got Array ([5]). You have to pass an explicitly␤typed array, not one that just might happen to contain elements of the␤correct type.␤  in block <unit> at <tmp> line 1␤␤»

[19:11] <ab5tract> m: role R[::T] { has Array[T] $.t }; dd R[Int].new: t => my Int @ = [5]

[19:11] <camelia> rakudo-moar 04a36dd13: OUTPUT: «R[Int].new(t => Array[Int].new(5))␤»

[19:11] <ab5tract> This works in RakuAST as well. Which implies that the problem is actually some subtle thingy happening with RakuAST::Trait::Is 

[19:12] <ab5tract> m: role R[::T] { has T @.t }; dd R[Int].new: t => my Int @ = [5]

[19:12] <camelia> rakudo-moar 04a36dd13: OUTPUT: «R[Int].new(t => Array[Int].new(5))␤»

[19:13] <ab5tract> I can't use the .AST.EVAL trick to demonstrate it here, though, because instantiating R explodes

[19:44] *** coleman left
[19:45] *** coleman joined
[22:01] *** melezhik left
[23:54] *** finanalyst left
